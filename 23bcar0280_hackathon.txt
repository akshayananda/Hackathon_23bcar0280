import speech_recognition as sr
import pyttsx3
import requests
import time

recognizer = sr.Recognizer()
engine = pyttsx3.init()

def speak(text):
    engine.say(text)
    engine.runAndWait()

def listen():
    with sr.Microphone() as source:
        print("Listening for your command...")
        recognizer.adjust_for_ambient_noise(source)
        audio = recognizer.listen(source)
    try:
        print("Recognizing...")
        command = recognizer.recognize_google(audio)
        print(f"You said: {command}")
        return command.lower()
    except sr.UnknownValueError:
        print("Sorry, I could not understand the audio.")
        return None
    except sr.RequestError:
        print("There was an issue with the request.")
        return None

def search_shopping_api(query):
    mock_products = {
        "shoes": ["Nike Air Max", "Adidas Ultraboost", "Puma Speedcat"],
        "phone": ["iPhone 13", "Samsung Galaxy S21", "Google Pixel 6"],
        "laptop": ["Dell XPS 13", "MacBook Pro 2021", "HP Spectre x360"]
    }
    
    products = mock_products.get(query, [])
    
    if not products:
        return None
    
    return products

def get_personalized_suggestions():
    return ["Smartphone", "Headphones", "Smartwatch"]

if __name__ == "__main__":
    speak("Welcome to your AI-powered shopping assistant.")
    
    while True:
        command = listen()
        
        if command:
            if "search for" in command:
                query = command.replace("search for", "").strip()
                speak(f"Searching for {query}...")
                search_results = search_shopping_api(query)
                
                if search_results:
                    speak(f"I found the following products: {', '.join(search_results)}")
                else:
                    speak(f"Sorry, I couldn't find anything related to {query}. Would you like a recommendation?")
            
            elif "recommend" in command or "suggest" in command:
                speak("Here are some personalized recommendations for you.")
                recommendations = get_personalized_suggestions()
                speak(f"You may like: {', '.join(recommendations)}")
            
            elif "add to cart" in command:
                speak("I am adding items to your cart. You can continue shopping or proceed to checkout.")

            elif "bye" in command or "exit" in command:
                speak("Goodbye! Happy shopping!")
                break
            
            else:
                speak("I'm sorry, I didn't understand that. Please try again.")

        time.sleep(1)
